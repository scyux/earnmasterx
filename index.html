<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Earn Master Auto Ads</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500&family=Raleway:wght@400;600&display=swap');
* { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Raleway', sans-serif; }
body {
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    color: #fff;
    position: relative;
}
@keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}
.container {
    background: rgba(20,20,20,0.85);
    padding: 30px;
    border-radius: 20px;
    width: 360px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.7);
    text-align: center;
}
h1 {
    font-family: 'Orbitron', sans-serif;
    font-size: 28px;
    color: #00ffcc;
    margin-bottom: 15px;
}
.stats p {
    font-size: 15px;
    margin: 6px 0;
}
.progress-circle {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: conic-gradient(#00ffcc 0%, rgba(0,255,204,0.1) 0%);
    margin: 15px auto;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 18px;
    color: #00ffcc;
    transition: background 0.5s ease;
}
.buttons button {
    width: 95%;
    padding: 12px;
    margin: 8px 0;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    color: #fff;
    background: linear-gradient(45deg,#ff512f,#dd2476);
    transition: 0.3s;
}
.buttons button:hover { background: linear-gradient(45deg,#dd2476,#ff512f); }
.buttons button:disabled { background: #555; cursor: not-allowed; opacity: 0.6; }

#countdown {
    margin: 12px 0;
    font-size: 16px;
    color: #ffd966;
    font-weight: bold;
}
#countdown span { color: #00ffcc; font-size: 18px; }

/* Reklam Konteyneri - Sağ Üst */
.ad-container {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 320px;
    max-width: 90vw;
    background: #111;
    border: 2px solid #00ffcc;
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.6);
    z-index: 9999;
    overflow: hidden;
    display: none;
}
.ad-close {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 32px;
    height: 32px;
    background: #ff4444;
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
}
.ad-close:hover { background: #ff0000; }
</style>
</head>
<body>

<div class="container">
    <h1>Earn Master</h1>
    <div class="stats">
        <p>İzlenen Reklam: <span id="watched-ads">0</span></p>
        <p>Kazanılan Puan: <span id="earned-points">0.00</span></p>
    </div>
    <div class="progress-circle" id="progress-circle">
        <span id="ads-progress">0%</span>
    </div>
    <div id="countdown">Sonraki reklam: <span id="timer">15</span>s</div>

    <div class="buttons">
        <button id="auto-ad-btn">Auto Ads Başlat</button>
        <button id="stop-auto-btn" disabled>Auto Ads Durdur</button>
    </div>
</div>

<!-- Reklam Penceresi (Sağ Üst) -->
<div id="ad-container" class="ad-container">
    <button id="ad-close" class="ad-close">X</button>
    <div id="ad-content"></div>
</div>

<!-- Monetag SDK -->
<script src="https://libtl.com/sdk.js" data-zone="10175246" data-sdk="show_10175246"></script>

<script>
// --- Veri ve UI ---
let watchedAdsCount = parseInt(localStorage.getItem('watchedAdsCount')) || 0;
let earnedPoints = parseFloat(localStorage.getItem('earnedPoints')) || 0;
let autoRunning = false;
let countdownInterval = null;
let adTimeout = null;
let sdkReady = false;

// UI Güncelle
function updateUI() {
    document.getElementById('watched-ads').textContent = watchedAdsCount;
    document.getElementById('earned-points').textContent = earnedPoints.toFixed(2);
    const percent = Math.min((watchedAdsCount % 10) * 10, 100);
    document.getElementById('ads-progress').textContent = percent + '%';
    document.getElementById('progress-circle').style.background = 
        `conic-gradient(#00ffcc ${percent}%, rgba(0,255,204,0.1) ${percent}%)`;
}
updateUI();

// SDK Kontrol
function checkSDK() {
    if (typeof window.show_10175246 === 'function') {
        sdkReady = true;
        console.log('Monetag SDK yüklendi');
    } else {
        setTimeout(checkSDK, 500);
    }
}
checkSDK();

// Geri Sayım
function startCountdown(seconds, callback) {
    const timerEl = document.getElementById('timer');
    let left = seconds;
    timerEl.textContent = left;

    clearInterval(countdownInterval);
    countdownInterval = setInterval(() => {
        left--;
        timerEl.textContent = left;
        if (left <= 0) {
            clearInterval(countdownInterval);
            if (callback) callback();
        }
    }, 1000);
}

// Reklamı Aç + 15s sonra X'e otomatik tıkla
async function showAdAndAutoClose() {
    if (!sdkReady || !autoRunning) return;

    const container = document.getElementById('ad-container');
    const content = document.getElementById('ad-content');
    const closeBtn = document.getElementById('ad-close');

    // Temizle
    content.innerHTML = '';
    container.style.display = 'block';

    try {
        await show_10175246({ target: content });

        // 15 SANİYE SONRA X BUTONUNA OTOMATİK TIKLAMA
        adTimeout = setTimeout(() => {
            closeBtn.click(); // OTOMATİK TIKLAMA
        }, 15000);

    } catch (e) {
        console.error('Reklam hatası:', e);
        setTimeout(() => closeBtn.click(), 2000);
    }
}

// X'e tıklanınca (manuel veya otomatik)
document.getElementById('ad-close').onclick = () => {
    clearTimeout(adTimeout);
    document.getElementById('ad-container').style.display = 'none';

    // Puan ver
    watchedAdsCount++;
    earnedPoints += 0.5;
    localStorage.setItem('watchedAdsCount', watchedAdsCount);
    localStorage.setItem('earnedPoints', earnedPoints.toFixed(2));
    updateUI();

    // Yeni döngü
    if (autoRunning) {
        startCountdown(15, showAdAndAutoClose);
    }
};

// Auto Ads Başlat
document.getElementById('auto-ad-btn').onclick = () => {
    if (!sdkReady) {
        alert('Reklam sistemi yükleniyor, lütfen bekleyin...');
        return;
    }
    if (autoRunning) return;

    autoRunning = true;
    document.getElementById('auto-ad-btn').disabled = true;
    document.getElementById('stop-auto-btn').disabled = false;

    showAdAndAutoClose();
};

// Auto Ads Durdur
document.getElementById('stop-auto-btn').onclick = () => {
    autoRunning = false;
    clearInterval(countdownInterval);
    clearTimeout(adTimeout);
    document.getElementById('ad-container').style.display = 'none';
    document.getElementById('auto-ad-btn').disabled = false;
    document.getElementById('stop-auto-btn').disabled = true;
};

// Sayfa kapanırken temizle
window.addEventListener('beforeunload', () => {
    if (autoRunning) {
        document.getElementById('stop-auto-btn').click();
    }
});
</script>
</body>
</html>