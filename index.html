<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Earn Master</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500&family=Poppins:wght@400;600&display=swap');
* { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif; }
body {
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:linear-gradient(135deg,#1a0b3d,#2a1a5e,#0f0c29);
    background-size:400% 400%;
    animation:bgAnim 12s ease infinite;
    color:#fff;
    overflow:hidden;
}
@keyframes bgAnim{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.container {
    background:rgba(15,15,30,0.92);
    padding:28px;
    border-radius:18px;
    width:340px;
    text-align:center;
    box-shadow:0 12px 40px rgba(0,0,0,0.6);
    border:1px solid rgba(0,255,204,0.2);
}
h1 {
    font-family:'Orbitron',sans-serif;
    font-size:26px;
    color:#00ffcc;
    margin-bottom:12px;
    text-shadow:0 0 8px rgba(0,255,204,0.5);
}
.stats { margin:12px 0; font-size:15px; }
.stats p { margin:5px 0; }
.progress-bar {
    width:100%;
    height:8px;
    background:rgba(0,255,204,0.1);
    border-radius:4px;
    overflow:hidden;
    margin:12px 0;
}
.progress-fill {
    height:100%;
    width:0%;
    background:linear-gradient(90deg,#00ffcc,#00b894);
    border-radius:4px;
    transition:width 0.6s ease;
}
#countdown {
    font-size:15px;
    color:#ffd700;
    font-weight:600;
    margin:10px 0;
}
#countdown span { color:#00ffcc; font-size:17px; }
.btn {
    width:100%;
    padding:12px;
    margin:8px 0;
    border:none;
    border-radius:12px;
    font-weight:600;
    font-size:16px;
    cursor:pointer;
    transition:0.3s;
}
#auto-btn {
    background:linear-gradient(45deg,#ff512f,#dd2476);
    color:#fff;
}
#auto-btn:hover { background:linear-gradient(45deg,#dd2476,#ff512f); }
#stop-btn {
    background:#444;
    color:#ccc;
}
#stop-btn:hover { background:#555; }
#stop-btn:disabled { background:#333; cursor:not-allowed; opacity:0.6; }

/* Reklam Konteyneri - Sağ Üst */
.ad-box {
    position:fixed;
    top:15px;
    right:15px;
    width:310px;
    max-width:90vw;
    height:260px;
    background:#111;
    border:2px solid #00ffcc;
    border-radius:14px;
    box-shadow:0 8px 30px rgba(0,0,0,0.7);
    z-index:9999;
    overflow:hidden;
    display:none;
    flex-direction:column;
}
.ad-close {
    position:absolute;
    top:8px;
    right:8px;
    width:34px;
    height:34px;
    background:#e74c3c;
    color:#fff;
    border:none;
    border-radius:50%;
    font-size:18px;
    font-weight:bold;
    cursor:pointer;
    z-index:10000;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow:0 2px 8px rgba(0,0,0,0.4);
}
.ad-close:hover { background:#c0392b; transform:scale(1.1); }
.ad-content {
    flex:1;
    width:100%;
    height:100%;
    border:none;
}
</style>
</head>
<body>

<div class="container">
    <h1>Earn Master</h1>
    <div class="stats">
        <p>İzlenen: <span id="watched">0</span></p>
        <p>Puan: <span id="points">0.00</span></p>
    </div>
    <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
    <div id="countdown">Sonraki: <span id="timer">15</span>s</div>
    <button id="auto-btn" class="btn">Auto Ads Başlat</button>
    <button id="stop-btn" class="btn" disabled>Auto Ads Durdur</button>
</div>

<!-- Reklam Alanı -->
<div id="ad-box" class="ad-box">
    <button id="ad-close" class="ad-close">X</button>
    <div id="ad-content" class="ad-content"></div>
</div>

<!-- Monetag SDK -->
<script src="https://libtl.com/sdk.js" data-zone="10175246" data-sdk="show_10175246"></script>

<script>
let watched = parseInt(localStorage.getItem('watched')||0);
let points = parseFloat(localStorage.getItem('points')||0);
let running = false;
let timer = null;
let adTimer = null;
let sdkOk = false;

// UI
function update() {
    document.getElementById('watched').textContent = watched;
    document.getElementById('points').textContent = points.toFixed(2);
    const pct = Math.min((watched % 10) * 10, 100);
    document.getElementById('progress-fill').style.width = pct + '%';
}
update();

// SDK Kontrol
function checkSDK() {
    if (typeof window.show_10175246 === 'function') {
        sdkOk = true;
        console.log('Monetag yüklendi');
    } else setTimeout(checkSDK, 500);
}
checkSDK();

// Geri Sayım
function countdown(sec, cb) {
    const el = document.getElementById('timer');
    let s = sec;
    el.textContent = s;
    clearInterval(timer);
    timer = setInterval(() => {
        s--;
        el.textContent = s;
        if (s <= 0) { clearInterval(timer); if(cb) cb(); }
    }, 1000);
}

// Reklam Göster + Otomatik Kapat
async function showAd() {
    if (!sdkOk || !running) return;
    const box = document.getElementById('ad-box');
    const content = document.getElementById('ad-content');
    const closeBtn = document.getElementById('ad-close');
    content.innerHTML = '';
    box.style.display = 'flex';

    try {
        await show_10175246({ target: content });
        // 15 saniye sonra X'e otomatik tıkla
        adTimer = setTimeout(() => closeBtn.click(), 15000);
    } catch(e) {
        console.error('Reklam hatası:', e);
        setTimeout(() => closeBtn.click(), 2000);
    }
}

// X'e tıklandığında (otomatik/manuel)
document.getElementById('ad-close').onclick = () => {
    clearTimeout(adTimer);
    document.getElementById('ad-box').style.display = 'none';
    watched++;
    points += 0.5;
    localStorage.setItem('watched', watched);
    localStorage.setItem('points', points.toFixed(2));
    update();
    if (running) countdown(15, showAd);
};

// Başlat
document.getElementById('auto-btn').onclick = () => {
    if (!sdkOk) { alert('Yükleniyor...'); return; }
    if (running) return;
    running = true;
    document.getElementById('auto-btn').disabled = true;
    document.getElementById('stop-btn').disabled = false;
    showAd();
};

// Durdur
document.getElementById('stop-btn').onclick = () => {
    running = false;
    clearInterval(timer);
    clearTimeout(adTimer);
    document.getElementById('ad-box').style.display = 'none';
    document.getElementById('auto-btn').disabled = false;
    document.getElementById('stop-btn').disabled = true;
};

// Sayfa kapanırken durdur
window.addEventListener('beforeunload', () => {
    if (running) document.getElementById('stop-btn').click();
});
</script>
</body>
</html>