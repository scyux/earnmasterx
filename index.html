<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Earn Master ‚Äî Fast Auto Ads</title>
<style>
body{font-family:sans-serif;background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);height:100vh;display:flex;align-items:center;justify-content:center;color:#fff}
.container{background:rgba(20,20,20,.9);padding:24px;border-radius:16px;width:360px;box-shadow:0 10px 30px rgba(0,0,0,.6);text-align:center}
h1{color:#00ffcc;font-family:Orbitron,Arial,sans-serif;margin-bottom:10px}
button{width:100%;padding:10px;margin-top:8px;border:none;border-radius:10px;font-weight:600;cursor:pointer}
button.primary{background:linear-gradient(45deg,#ff512f,#dd2476);color:#fff}
button.ghost{background:transparent;border:1px solid rgba(255,255,255,.2);color:#fff}
#countdown{margin-top:10px;color:#ffda75;font-size:14px}
</style>
</head>
<body>
<div class="container">
  <h1>Earn Master</h1>
  <p>Watched Ads: <span id="watched">0</span></p>
  <p>Earned Points: <span id="points">0.00</span></p>
  <button id="auto-btn" class="primary">Start Auto Ads (15s)</button>
  <button id="stop-btn" class="ghost" disabled>Stop Auto</button>
  <div id="countdown" style="display:none;">Next ad in <span id="sec">15</span>s...</div>
</div>

<!-- Monetag SDK -->
<script src="https://libtl.com/sdk.js" data-zone="10175246" data-sdk="show_10175246"></script>

<script>
let monetagLoaded = false;
let autoMode = false;
let stopFlag = false;
let watched = parseInt(localStorage.getItem('watched')||0);
let points = parseFloat(localStorage.getItem('points')||0);
const wEl=document.getElementById('watched');
const pEl=document.getElementById('points');
const cEl=document.getElementById('countdown');
const secEl=document.getElementById('sec');

function updateUI(){
  wEl.textContent=watched;
  pEl.textContent=points.toFixed(2);
}
updateUI();

// SDK hazƒ±r mƒ±
function checkSDK(){
  if(typeof window.show_10175246==='function'){
    monetagLoaded=true;
    console.log('‚úÖ Monetag SDK ready');
  }else setTimeout(checkSDK,800);
}
checkSDK();

function saveProgress(){
  localStorage.setItem('watched',watched);
  localStorage.setItem('points',points.toFixed(2));
}

// Reklam g√∂ster + 15 saniye sonra yeni reklam
async function showAdOnce(){
  if(!monetagLoaded){console.log('SDK not ready');return;}

  let finished=false;
  console.log('‚ñ∂Ô∏è Showing ad...');

  // SDK √ßaƒürƒ±sƒ± + fallback
  try{
    const maybePromise = show_10175246({
      onReward:()=>{ if(!finished){ finished=true; adRewarded(); } },
      onClose: ()=>{ if(!finished){ finished=true; adClosed(); } },
      onError: (e)=>{ console.warn('Ad error',e); finished=true; }
    });

    if(maybePromise && typeof maybePromise.then==='function'){
      maybePromise.then(()=>{ if(!finished){ finished=true; adClosed(); } })
                  .catch(e=>{ console.warn('Promise error',e); finished=true; });
    }

  }catch(e){ console.warn('show_10175246 failed',e); }

  // fallback: 20 saniye sonra kapandƒ± varsay
  setTimeout(()=>{
    if(!finished){
      console.log('‚ö†Ô∏è No close event detected, assuming ad finished.');
      finished=true; adClosed();
    }
  },20000);
}

// Kullanƒ±cƒ± √∂d√ºl kazandƒ±
function adRewarded(){
  watched++;
  points+=0.5;
  saveProgress();updateUI();
  console.log('‚úÖ Ad rewarded');
}

// Reklam kapandƒ±ktan sonra yeni reklam planla
async function adClosed(){
  console.log('üîÅ Ad closed ‚Äî waiting 15s before next');
  if(!autoMode) return;

  // 15s geri sayƒ±m
  await countdown(15);
  if(stopFlag){stopFlag=false;return;}
  showAdOnce();
}

function countdown(sec){
  return new Promise(resolve=>{
    cEl.style.display='block';
    let s=sec;
    secEl.textContent=s;
    const timer=setInterval(()=>{
      s--;secEl.textContent=s;
      if(s<=0){clearInterval(timer);cEl.style.display='none';resolve();}
    },1000);
  });
}

// Auto Ads ba≈ülat/durdur
document.getElementById('auto-btn').onclick=()=>{
  if(!monetagLoaded){alert('SDK hen√ºz hazƒ±r deƒüil');return;}
  autoMode=true;stopFlag=false;
  document.getElementById('auto-btn').disabled=true;
  document.getElementById('stop-btn').disabled=false;
  showAdOnce(); // ilk reklam
};
document.getElementById('stop-btn').onclick=()=>{
  autoMode=false;stopFlag=true;
  document.getElementById('auto-btn').disabled=false;
  document.getElementById('stop-btn').disabled=true;
  cEl.style.display='none';
  console.log('‚èπÔ∏è Auto Ads stopped');
};
</script>
</body>
</html>
