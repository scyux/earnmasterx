<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Earn Master</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Orbitron:wght@500&display=swap');
* { margin:0; padding:0; box-sizing:border-box; }
body {
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:linear-gradient(135deg,#1a0b3d,#2a1a5e,#0f0c29);
    background-size:400% 400%;
    animation:bg 12s ease infinite;
    color:#fff;
    font-family:'Poppins',sans-serif;
    overflow:hidden;
    position:relative;
}
@keyframes bg{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.container {
    background:rgba(15,15,30,0.92);
    padding:28px;
    border-radius:18px;
    width:340px;
    text-align:center;
    box-shadow:0 12px 40px rgba(0,0,0,0.6);
    border:1px solid rgba(0,255,204,0.2);
    z-index:10;
}
h1 {
    font-family:'Orbitron',sans-serif;
    font-size:26px;
    color:#00ffcc;
    margin-bottom:12px;
    text-shadow:0 0 8px rgba(0,255,204,0.5);
}
.stats { margin:12px 0; font-size:15px; }
.stats p { margin:5px 0; }
.progress-bar {
    width:100%;
    height:8px;
    background:rgba(0,255,204,0.1);
    border-radius:4px;
    overflow:hidden;
    margin:12px 0;
}
.progress-fill {
    height:100%;
    width:0%;
    background:linear-gradient(90deg,#00ffcc,#00b894);
    border-radius:4px;
    transition:width 0.6s ease;
}
#countdown {
    font-size:15px;
    color:#ffd700;
    font-weight:600;
    margin:10px 0;
}
#countdown span { color:#00ffcc; font-size:17px; }
.btn {
    width:100%;
    padding:12px;
    margin:8px 0;
    border:none;
    border-radius:12px;
    font-weight:600;
    font-size:16px;
    cursor:pointer;
    transition:0.3s;
}
#auto-btn {
    background:linear-gradient(45deg,#ff512f,#dd2476);
    color:#fff;
}
#auto-btn:hover { background:linear-gradient(45deg,#dd2476,#ff512f); }
#stop-btn {
    background:#444;
    color:#ccc;
}
#stop-btn:hover { background:#555; }
#stop-btn:disabled { background:#333; cursor:not-allowed; opacity:0.6; }

#monetag-ad {
    position: fixed;
    top: 15px;
    right: 15px;
    width: 310px;
    max-width: 90vw;
    height: 260px;
    z-index: 9999;
    border: 2px solid #00ffcc;
    border-radius: 14px;
    overflow: hidden;
    box-shadow: 0 8px 30px rgba(0,0,0,0.7);
    display: none;
    opacity: 0;
    transition: opacity 0.3s;
}
#monetag-ad.visible {
    display: block;
    opacity: 1;
}
</style>
</head>
<body>

<div class="container">
    <h1>Earn Master</h1>
    <div class="stats">
        <p>İzlenen: <span id="watched">0</span></p>
        <p>Puan: <span id="points">0.00</span></p>
    </div>
    <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
    <div id="countdown">Sonraki: <span id="timer">15</span>s</div>
    <button id="auto-btn" class="btn">Auto Ads Başlat</button>
    <button id="stop-btn" class="btn" disabled>Auto Ads Durdur</button>
    <div id="monetag-ad"></div>
</div>

<script src="https://libtl.com/sdk.js" data-zone="10175246" data-sdk="show_10175246"></script>

<script>
let watched = parseInt(localStorage.getItem('watched') || 0);
let points = parseFloat(localStorage.getItem('points') || 0);
let running = false;
let countdownTimer = null;
let observer = null;
let sdkReady = false;

function updateUI() {
    document.getElementById('watched').textContent = watched;
    document.getElementById('points').textContent = points.toFixed(2);
    const pct = Math.min((watched % 10) * 10, 100);
    document.getElementById('progress-fill').style.width = pct + '%';
}
updateUI();

function checkSDK() {
    if (typeof window.show_10175246 === 'function') {
        sdkReady = true;
    } else {
        setTimeout(checkSDK, 500);
    }
}
checkSDK();

function hideAd() {
    const ad = document.getElementById('monetag-ad');
    ad.classList.remove('visible');
    setTimeout(() => {
        ad.innerHTML = '';
        ad.style.display = 'none';
    }, 300);
}

// Reklam KAPANDIĞINDA tetiklenir
function onAdClosed() {
    if (!running) return;

    // Ödül ver
    watched++;
    points += 0.5;
    localStorage.setItem('watched', watched);
    localStorage.setItem('points', points.toFixed(2));
    updateUI();

    // 15 saniye bekle → yeni reklam
    let s = 15;
    document.getElementById('timer').textContent = s;
    countdownTimer = setInterval(() => {
        s--;
        document.getElementById('timer').textContent = s;
        if (s <= 0) {
            clearInterval(countdownTimer);
            if (running) showAd();
        }
    }, 1000);
}

function showAd() {
    if (!running || !sdkReady) return;

    const ad = document.getElementById('monetag-ad');
    ad.innerHTML = '';
    ad.style.display = 'block';
    ad.classList.remove('visible');

    // iframe kaldırıldığında tetiklenmesi için observer
    if (observer) observer.disconnect();
    observer = new MutationObserver(() => {
        const iframe = ad.querySelector('iframe');
        if (!iframe) {
            // iframe kaldırıldı → reklam kapatıldı
            observer.disconnect();
            onAdClosed();
        }
    });
    observer.observe(ad, { childList: true });

    show_10175246({ target: ad }).then(() => {
        // iframe yüklendiyse şeffaflığı kaldır
        const iframe = ad.querySelector('iframe');
        if (iframe) {
            iframe.style.opacity = '0';
            iframe.style.transition = 'opacity 0.4s';
            setTimeout(() => {
                if (ad.contains(iframe)) {
                    iframe.style.opacity = '1';
                    ad.classList.add('visible');
                }
            }, 600);
        } else {
            ad.classList.add('visible');
        }
    }).catch(e => {
        console.error('Reklam hatası:', e);
        observer.disconnect();
        hideAd();
        setTimeout(() => {
            if (running) onAdClosed(); // hata da "kapatma" gibi değerlendir
        }, 15000);
    });
}

// Butonlar
document.getElementById('auto-btn').onclick = () => {
    if (!sdkReady) {
        alert('Reklam sistemi yükleniyor, lütfen bekleyin...');
        return;
    }
    if (running) return;
    running = true;
    document.getElementById('auto-btn').disabled = true;
    document.getElementById('stop-btn').disabled = false;
    showAd();
};

document.getElementById('stop-btn').onclick = () => {
    running = false;
    clearInterval(countdownTimer);
    if (observer) observer.disconnect();
    hideAd();
    document.getElementById('auto-btn').disabled = false;
    document.getElementById('stop-btn').disabled = true;
};

window.addEventListener('beforeunload', () => {
    if (running) document.getElementById('stop-btn').click();
});
</script>
</body>
</html>